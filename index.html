<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FDA Regulatory Determination Tool</title>
<meta name="description" content="Interactive decision tree to determine FDA regulatory requirements for drugs, biologics, and medical devices">

```
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {
margin: 0;
padding: 0;
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
sans-serif;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
}

/* Loading animation */
#loading {
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
text-align: center;
z-index: 9999;
}

.spinner {
border: 4px solid #f3f3f3;
border-top: 4px solid #3498db;
border-radius: 50%;
width: 40px;
height: 40px;
animation: spin 1s linear infinite;
margin: 0 auto 20px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

#error-message {
display: none;
background: #fee;
border: 2px solid #f00;
padding: 20px;
border-radius: 8px;
max-width: 500px;
margin: 20px auto;
}
</style>
```

</head>
<body>
<div id="loading">
<div class="spinner"></div>
<p style="color: #666;">Loading FDA Decision Tree...</p>
<p style="color: #999; font-size: 12px; margin-top: 10px;">If this takes more than 10 seconds, please refresh the page</p>
</div>

```
<div id="error-message">
<h2 style="color: #c00;">Loading Error</h2>
<p>The application couldn't load properly. This might be due to:</p>
<ul style="text-align: left;">
<li>Ad blocker blocking resources</li>
<li>Network/firewall restrictions</li>
<li>Browser compatibility issues</li>
</ul>
<p><strong>Try:</strong></p>
<ol style="text-align: left;">
<li>Disable ad blockers</li>
<li>Try a different browser</li>
<li>Check your internet connection</li>
</ol>
<button onclick="location.reload()" style="background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">
Reload Page
</button>
</div>

<div id="root"></div>

<!-- React and dependencies -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Error handling -->
<script>
// Set timeout to show error if taking too long
setTimeout(function() {
if (document.getElementById('loading').style.display !== 'none') {
document.getElementById('loading').style.display = 'none';
document.getElementById('error-message').style.display = 'block';
}
}, 15000); // 15 seconds

// Check if React loaded
window.onerror = function(msg, url, lineNo, columnNo, error) {
console.error('Error: ', msg, url, lineNo);
document.getElementById('loading').style.display = 'none';
document.getElementById('error-message').style.display = 'block';
return false;
};
</script>

<script type="text/babel">
const { useState } = React;

// Lucide icons as inline SVG components (no CDN dependency)
const ChevronRight = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
);

const ChevronLeft = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
);

const HelpCircle = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<circle cx="12" cy="12" r="10"></circle>
<path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
<line x1="12" y1="17" x2="12.01" y2="17"></line>
</svg>
);

const FileText = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
<polyline points="14 2 14 8 20 8"></polyline>
<line x1="16" y1="13" x2="8" y2="13"></line>
<line x1="16" y1="17" x2="8" y2="17"></line>
<polyline points="10 9 9 9 8 9"></polyline>
</svg>
);

const CheckCircle = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
<polyline points="22 4 12 14.01 9 11.01"></polyline>
</svg>
);

const AlertCircle = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" y1="8" x2="12" y2="12"></line>
<line x1="12" y1="16" x2="12.01" y2="16"></line>
</svg>
);

const Info = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<circle cx="12" cy="12" r="10"></circle>
<line x1="12" y1="16" x2="12" y2="12"></line>
<line x1="12" y1="8" x2="12.01" y2="8"></line>
</svg>
);

const Download = (props) => (
<svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
<polyline points="7 10 12 15 17 10"></polyline>
<line x1="12" y1="15" x2="12" y2="3"></line>
</svg>
);

const FDADecisionTreeBot = () => {
const [currentStep, setCurrentStep] = useState('start');
const [answers, setAnswers] = useState({});
const [history, setHistory] = useState(['start']);
const [showDefinition, setShowDefinition] = useState(null);

// Definitions and help text
const definitions = {
IND: "Investigational New Drug Application - Required for clinical investigation of a drug that is not yet approved by FDA",
IDE: "Investigational Device Exemption - Required for clinical investigation of a medical device that is not yet cleared/approved by FDA",
SR: "Significant Risk Device - A device that presents a potential for serious risk to health, safety, or welfare",
NSR: "Non-Significant Risk Device - A device that does not present significant risk",
IVD: "In-Vitro Diagnostic Device - Reagents, instruments, and systems intended for use in diagnosis of disease",
lawfullyMarketed: "A drug that is currently approved by the FDA and legally sold in the United States",
customDevice: "A device made specifically for one patient under a physician's order, not generally available to other doctors"
};

// Question flow structure with enriched content
const questions = {
start: {
type: 'category',
text: 'What type of product are you investigating?',
description: 'Select the category that best describes your study product',
options: [
{ value: 'drug', label: 'Drug or Biologic', icon: 'ðŸ’Š', next: 'drug_q1' },
{ value: 'device', label: 'Medical Device', icon: 'ðŸ”¬', next: 'device_q1' }
]
},

// DRUGS/BIOLOGICS SECTION
drug_q1: {
text: 'Is this drug one of the following in vitro diagnostic biological products?',
description: 'Check if the drug falls into any of these specific categories',
type: 'multi-checkbox',
options: [
{ value: 'blood_grouping', label: 'Blood grouping serum' },
{ value: 'reagent_cells', label: 'Reagent red blood cells' },
{ value: 'anti_human', label: 'Anti-human globulin' }
],
helpText: 'These products are used in diagnostic procedures that confirm diagnoses made by other established methods',
yesOutcome: 'drug_exempt_invitro',
noNext: 'drug_q1b'
},

drug_q1b: {
text: 'Is the drug intended solely for in vitro tests or laboratory research animals?',
description: 'And shipped in compliance with 21 CFR 312.160',
type: 'boolean',
helpText: 'This means the drug will only be used in test tubes or with lab animals, not in humans',
yesOutcome: 'drug_exempt_invitro',
noNext: 'drug_q2'
},

drug_q2: {
text: 'Is the drug lawfully marketed in the United States?',
description: 'Is this drug currently FDA-approved and legally sold in the US?',
type: 'boolean',
definitionKey: 'lawfullyMarketed',
helpText: 'You can verify this by checking the FDA Orange Book or Purple Book',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q2a'
},

drug_q2a: {
text: 'Is the proposed use an approved indication in the US?',
description: 'Will you be using the drug for its FDA-approved purpose?',
type: 'boolean',
helpText: 'Example: Using aspirin to prevent heart attacks (approved) vs. using it to treat cancer (not approved)',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q2b'
},

drug_q2b: {
text: 'Is the formulation approved in the US?',
description: 'Are you using the approved form (e.g., tablets, injectables)?',
type: 'boolean',
helpText: 'Example: If the drug is approved as tablets, you cannot use it as an injectable without an IND',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q2c'
},

drug_q2c: {
text: 'Is the proposed regimen approved in the US?',
description: 'Dosage level, frequency, and duration',
type: 'boolean',
helpText: 'Example: Using 100mg twice daily when only 50mg once daily is approved would require an IND',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q2d'
},

drug_q2d: {
text: 'Is the proposed route of administration approved in the US?',
description: 'How the drug will be given to patients',
type: 'boolean',
helpText: 'Example: Oral (by mouth), intravenous (IV), topical (on skin), etc.',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q2e'
},

drug_q2e: {
text: 'Is the patient population approved in the US?',
description: 'Is this study population within the approved use?',
type: 'boolean',
helpText: 'Example: Using a drug approved for adults in a pediatric study would require an IND',
noOutcome: 'drug_ind_required',
yesNext: 'drug_q3'
},

drug_q3: {
text: 'Will the results be reported to FDA for a new indication?',
description: 'Are you seeking to expand the approved uses?',
type: 'boolean',
helpText: 'This means you plan to submit data to FDA to get approval for a new use',
yesOutcome: 'drug_ind_may_required',
noNext: 'drug_q4'
},

drug_q4: {
text: 'Is this intended to support a significant change in product labeling?',
description: 'Will this study potentially change how the drug is labeled?',
type: 'boolean',
helpText: 'Significant labeling changes typically require FDA review',
yesOutcome: 'drug_ind_may_required',
noNext: 'drug_q5'
},

drug_q5: {
text: 'Is this intended to support a significant change in advertising?',
description: 'Will this study be used to market the drug differently?',
type: 'boolean',
helpText: 'Claims in advertising must be supported by FDA-approved information',
yesOutcome: 'drug_ind_may_required',
noNext: 'drug_q6'
},

drug_q6: {
text: 'Does this investigation involve factors that significantly increase risks?',
description: 'Or decrease the acceptability of known risks?',
type: 'boolean',
helpText: 'Example: Combining the drug with another treatment that might increase side effects',
yesOutcome: 'drug_ind_may_required',
noOutcome: 'drug_exempt'
},

// MEDICAL DEVICES SECTION
device_q1: {
text: 'Is a medical device being proposed for use in this study?',
description: 'Based on the FDA definition below',
type: 'boolean',
longDescription: 'A medical device is an instrument, apparatus, implement, machine, contrivance, implant, in vitro reagent, or similar article that is intended for use in diagnosis, cure, treatment, or prevention of disease, or to affect body structure/function, and does NOT achieve its purpose through chemical action or metabolism.',
helpText: 'Examples: Surgical instruments, imaging equipment, diagnostic tests, implants',
noOutcome: 'device_not_applicable',
yesNext: 'device_q2'
},

device_q2: {
text: 'Is the medical device cleared or approved by the FDA?',
description: 'Has this device received FDA authorization?',
type: 'boolean',
helpText: 'You can verify this by checking the FDA 510(k) database or PMA database',
noNext: 'device_q4',
yesNext: 'device_q3'
},

device_q3: {
text: 'Will it be used according to its FDA-approved/cleared indications?',
description: 'Are you using the device exactly as FDA authorized?',
type: 'boolean',
helpText: 'Using a device outside its cleared/approved indication requires an IDE',
yesOutcome: 'device_exempt_approved',
noNext: 'device_q4'
},

device_q4: {
text: 'Is this an in-vitro diagnostic device (IVD)?',
description: 'Used for diagnosis through examination of specimens from the human body',
type: 'boolean',
definitionKey: 'IVD',
helpText: 'Examples: Blood tests, genetic tests, pregnancy tests, glucose monitors',
yesNext: 'ivd_q1',
noNext: 'device_section2_q1'
},

// IVD SECTION
ivd_q1: {
text: 'Is the IVD testing invasive?',
description: 'Does it require penetration of skin or body cavity?',
type: 'boolean',
helpText: 'Example: A blood draw is invasive; testing saliva is not',
yesOutcome: 'device_ide_required',
noNext: 'ivd_q2'
},

ivd_q2: {
text: 'Does the IVD require an invasive sampling procedure with significant risk?',
description: 'Is the sample collection dangerous?',
type: 'boolean',
helpText: 'Example: Spinal tap carries more risk than a finger prick',
yesOutcome: 'device_ide_required',
noNext: 'ivd_q3'
},

ivd_q3: {
text: 'Does the IVD introduce energy into a subject?',
description: 'Does the device emit radiation, electricity, or other energy?',
type: 'boolean',
helpText: 'Example: Imaging devices that use radiation',
yesOutcome: 'device_ide_required',
noNext: 'ivd_q4'
},

ivd_q4: {
text: 'Is the IVD used without confirming diagnosis by another established procedure?',
description: 'Is this the sole diagnostic method?',
type: 'boolean',
helpText: 'If another established test must confirm the results, this would be "No"',
yesOutcome: 'device_ide_required',
noNext: 'ivd_q5'
},

ivd_q5: {
text: 'Does the IVD use leftover specimens where subjects can be identified?',
description: 'Using stored samples from prior procedures',
type: 'boolean',
helpText: 'If specimens are completely anonymized, answer "No"',
noNext: 'ivd_exempt',
yesNext: 'ivd_q6'
},

ivd_q6: {
text: 'Are results communicated to or associated with identified subjects?',
description: 'Will participants receive their test results?',
type: 'boolean',
helpText: 'If results are never linked back to individuals, answer "No"',
yesOutcome: 'ivd_exempt_consent',
noOutcome: 'ivd_exempt'
},

// NON-IVD DEVICES SECTION
device_section2_q1: {
text: 'Is this consumer preference testing, testing a modification, or testing a combination?',
description: 'Of devices already in commercial distribution',
type: 'boolean',
helpText: 'Example: Testing if patients prefer blue vs. white bandages (not safety/effectiveness)',
noNext: 'device_section2_custom',
yesNext: 'device_section2_q2'
},

device_section2_q2: {
text: 'Is the testing for determining safety or effectiveness?',
description: 'Will this study evaluate if the device works or is safe?',
type: 'boolean',
helpText: 'Pure preference testing is not about safety/effectiveness',
yesNext: 'device_section2_q3',
noNext: 'device_section2_q3_check'
},

device_section2_q3_check: {
text: 'Does the testing put subjects at risk?',
description: 'Could participants be harmed by the testing?',
type: 'boolean',
helpText: 'Consider both physical and psychological risks',
yesNext: 'device_section2_custom',
noOutcome: 'device_exempt_consumer'
},

device_section2_q3: {
text: 'Does the testing put subjects at risk?',
description: 'Could participants be harmed by the testing?',
type: 'boolean',
helpText: 'Consider both physical and psychological risks',
yesNext: 'device_risk_q1',
noNext: 'device_section2_custom'
},

device_section2_custom: {
text: 'Is this a custom device?',
description: 'Made specifically for one named patient under a physician\'s order',
type: 'boolean',
definitionKey: 'customDevice',
longDescription: 'A custom device: (1) Deviates from generally available devices for a specific physician order, (2) Not generally used by other physicians, (3) Not available in finished form for purchase, (4) Not offered for commercial distribution, (5) Intended for a named patient or physician\'s special needs',
helpText: 'Example: A specially-designed prosthetic made for one specific patient',
yesNext: 'device_custom_commercial',
noNext: 'device_risk_q1'
},

device_custom_commercial: {
text: 'Is this custom device being studied for commercial distribution?',
description: 'To determine safety and effectiveness for general sale',
type: 'boolean',
helpText: 'If yes, IDE regulations apply despite being custom',
yesNext: 'device_risk_q1',
noOutcome: 'device_exempt_custom'
},

// RISK DETERMINATION SECTION
device_risk_q1: {
text: 'Is the device a banned device?',
description: 'Has FDA prohibited this device?',
type: 'boolean',
helpText: 'Very few devices are banned; check FDA\'s list of banned devices',
yesOutcome: 'device_sr_ide',
noNext: 'device_risk_q2'
},

device_risk_q2: {
text: 'Is this an implant (30+ days) that presents potential serious risk?',
description: 'Placed in a body cavity and intended to remain there',
type: 'boolean',
helpText: 'Examples: Pacemakers, artificial joints, stents',
yesOutcome: 'device_sr_ide',
noNext: 'device_risk_q3'
},

device_risk_q3: {
text: 'Does it support or sustain human life and present potential serious risk?',
description: 'Life-supporting or life-sustaining device',
type: 'boolean',
helpText: 'Examples: Ventilators, dialysis machines, heart-lung machines',
yesOutcome: 'device_sr_ide',
noNext: 'device_risk_q4'
},

device_risk_q4: {
text: 'Is it substantially important in diagnosing, curing, or treating disease with potential serious risk?',
description: 'Critical for important health outcomes',
type: 'boolean',
helpText: 'Consider both the importance of the use and the level of risk',
yesOutcome: 'device_sr_ide',
noNext: 'device_risk_q5'
},

device_risk_q5: {
text: 'Does the device present potential serious risk in any other way?',
description: 'Any serious risk not covered above',
type: 'boolean',
helpText: 'Consider all potential harms to health, safety, or welfare',
yesOutcome: 'device_sr_ide',
noOutcome: 'device_nsr'
}
};

// Outcomes with enhanced guidance
const outcomes = {
drug_exempt_invitro: {
title: 'IND Not Required',
type: 'success',
icon: CheckCircle,
message: 'Your drug study is exempt from IND requirements under 21 CFR 312.160.',
details: 'The drug falls under the in vitro diagnostic biological products exemption.',
requirements: [
'IRB review is still required (21 CFR 56)',
'Informed consent regulations apply (21 CFR 50)',
'Proper shipping and labeling compliance with 312.160'
],
nextSteps: [
'Submit protocol to your IRB for review',
'Ensure informed consent documents are prepared',
'Verify shipping and labeling compliance'
]
},

drug_ind_required: {
title: 'IND Required',
type: 'error',
icon: AlertCircle,
message: 'An Investigational New Drug (IND) application is required for this study.',
details: 'The drug does not meet all criteria for exemption from IND requirements.',
requirements: [
'Submit IND application to FDA before starting study',
'IRB review and approval required',
'Informed consent from all participants',
'Compliance with 21 CFR 312 regulations'
],
nextSteps: [
'Contact Regulatory Affairs immediately at RegAffairs@CDC.Gov',
'Prepare IND application documents',
'Do not begin study until IND is in effect',
'Ensure sponsor oversight and safety monitoring plans are in place'
]
},

drug_ind_may_required: {
title: 'IND May Be Required',
type: 'warning',
icon: AlertCircle,
message: 'An IND may be required based on your study characteristics.',
details: 'Additional consultation is needed to make a final determination.',
requirements: [
'Consultation with Regulatory Affairs is required',
'IRB review will be needed regardless',
'Informed consent regulations apply'
],
nextSteps: [
'Contact Regulatory Affairs at RegAffairs@CDC.Gov for consultation',
'Prepare detailed study protocol and rationale',
'Be prepared to justify the study design and objectives',
'Do not proceed until determination is made'
]
},

drug_exempt: {
title: 'Study Exempt from IND',
type: 'success',
icon: CheckCircle,
message: 'Your study is exempt from IND requirements.',
details: 'The drug meets all criteria for exemption under 21 CFR 312.2(b).',
requirements: [
'IRB review is required (21 CFR 56)',
'Informed consent is required (21 CFR 50)',
'Follow all other applicable regulations'
],
nextSteps: [
'Submit protocol to your IRB',
'Prepare informed consent documents',
'Maintain proper documentation and records',
'Monitor for any changes that might require IND'
]
},

device_not_applicable: {
title: 'Medical Device Regulations Do Not Apply',
type: 'info',
icon: Info,
message: 'FDA medical device regulations do not apply to your study.',
details: 'The product does not meet the definition of a medical device.',
requirements: [
'Consider if drug/biologic regulations apply instead',
'IRB review may still be required',
'Informed consent likely needed'
],
nextSteps: [
'If investigating a drug or biologic, complete the Drugs/Biologics section',
'Consult with your IRB regarding applicable regulations',
'Contact Regulatory Affairs if unsure about product classification'
]
},

device_exempt_approved: {
title: 'Exempt from IDE Regulations',
type: 'success',
icon: CheckCircle,
message: 'Your device study is exempt from IDE requirements.',
details: 'The device is FDA-cleared/approved and will be used according to its cleared/approved indications.',
requirements: [
'IRB review is required (21 CFR 56)',
'Informed consent is required (21 CFR 50)',
'Labeling requirements apply (21 CFR 812)',
'Clinical investigator disqualification regulations apply (21 CFR 812.119)'
],
nextSteps: [
'Submit protocol to your IRB',
'Ensure informed consent documents are prepared',
'Verify device is being used exactly as labeled',
'Maintain proper records of device use'
]
},

device_ide_required: {
title: 'IDE Required',
type: 'error',
icon: AlertCircle,
message: 'An Investigational Device Exemption (IDE) is required for this study.',
details: 'The device does not meet criteria for exemption from IDE requirements.',
requirements: [
'Submit IDE application to FDA (if significant risk)',
'IRB review and approval required',
'Informed consent from all participants',
'Compliance with 21 CFR 812 regulations'
],
nextSteps: [
'Contact Regulatory Affairs at RegAffairs@CDC.Gov for consultation',
'Determine if device is Significant Risk (SR) or Non-Significant Risk (NSR)',
'Prepare IDE application (if SR) or follow abbreviated requirements (if NSR)',
'Do not begin study until IDE is approved or IRB approves NSR determination'
]
},

ivd_exempt: {
title: 'IVD Study Exempt from IDE',
type: 'success',
icon: CheckCircle,
message: 'Your IVD study is exempt from IDE requirements.',
details: 'The IVD meets all criteria for exemption.',
requirements: [
'Labeling requirements still apply (21 CFR 809.10(c))',
'IRB review is required',
'Informed consent may not be required - consult Regulatory Affairs'
],
nextSteps: [
'Contact Regulatory Affairs at RegAffairs@CDC.Gov regarding informed consent requirements',
'Ensure proper labeling of investigational device',
'Submit protocol to IRB',
'Maintain documentation of exemption determination'
]
},

ivd_exempt_consent: {
title: 'IVD Study Exempt from IDE - Informed Consent Required',
type: 'success',
icon: CheckCircle,
message: 'Your IVD study is exempt from IDE requirements, but informed consent is required.',
details: 'Results are communicated to or associated with identified subjects.',
requirements: [
'Informed consent is required (21 CFR 50)',
'IRB review is required (21 CFR 56)',
'Labeling requirements apply (21 CFR 809.10(c))'
],
nextSteps: [
'Prepare informed consent documents',
'Submit protocol to IRB',
'Ensure proper labeling of investigational device',
'Maintain records of consent and device use'
]
},

device_exempt_consumer: {
title: 'Exempt from IDE Requirements',
type: 'success',
icon: CheckCircle,
message: 'Your device study is exempt from IDE requirements.',
details: 'The study qualifies as consumer preference testing without safety/effectiveness evaluation and without subject risk.',
requirements: [
'IRB review is required (21 CFR 56)',
'Informed consent is required (21 CFR 50)',
'Clinical investigator disqualification regulations apply (21 CFR 812.119)'
],
nextSteps: [
'Submit protocol to IRB',
'Prepare informed consent documents',
'Ensure study remains within consumer preference scope',
'Do not evaluate safety or effectiveness'
]
},

device_exempt_custom: {
title: 'Custom Device - Exempt from IDE',
type: 'success',
icon: CheckCircle,
message: 'Your custom device is exempt from IDE regulations.',
details: 'The device meets the definition of a custom device and is not being studied for commercial distribution.',
requirements: [
'Device must be for a named patient',
'Must comply with physician\'s order',
'Cannot be for commercial distribution',
'IRB review may be required',
'Informed consent likely needed'
],
nextSteps: [
'Verify device meets all custom device criteria',
'Consult with your IRB',
'Ensure proper documentation of physician order',
'Do not use for commercial distribution purposes'
]
},

device_sr_ide: {
title: 'Significant Risk Device - IDE Required',
type: 'error',
icon: AlertCircle,
message: 'This is a Significant Risk (SR) device. An IDE must be submitted to FDA.',
details: 'The device presents potential serious risk to health, safety, or welfare of subjects.',
requirements: [
'IDE application must be submitted to FDA',
'FDA approval required before study begins',
'IRB review and approval required',
'Informed consent from all participants',
'Full compliance with 21 CFR 812 regulations'
],
nextSteps: [
'Contact Regulatory Affairs immediately at RegAffairs@CDC.Gov',
'Prepare comprehensive IDE application',
'Do not begin study until FDA approves IDE',
'Ensure robust monitoring and safety protocols',
'Plan for ongoing reporting to FDA'
]
},

device_nsr: {
title: 'Non-Significant Risk Device',
type: 'warning',
icon: AlertCircle,
message: 'This appears to be a Non-Significant Risk (NSR) device.',
details: 'Abbreviated IDE requirements may apply, or the device may be exempt.',
requirements: [
'IRB must agree with NSR determination',
'Abbreviated IDE requirements (21 CFR 812.2(b))',
'Labeling requirements (21 CFR 812.5)',
'Monitoring investigations (21 CFR 812.46)',
'Records and reports (21 CFR 812.140, 812.150)',
'No promotion prohibition (21 CFR 812.7)'
],
nextSteps: [
'Contact Regulatory Affairs at RegAffairs@CDC.Gov to confirm NSR status and exemption eligibility',
'Submit NSR determination to IRB for concurrence',
'Follow abbreviated IDE requirements (no FDA submission needed)',
'Maintain required records and documentation',
'Ensure proper device labeling'
]
}
};

const handleAnswer = (questionKey, value) => {
setAnswers({ ...answers, [questionKey]: value });

const question = questions[questionKey];
let nextStep = null;

if (question.type === 'boolean') {
if (value === 'yes') {
nextStep = question.yesNext || question.yesOutcome;
} else {
nextStep = question.noNext || question.noOutcome;
}
} else if (question.type === 'multi-checkbox') {
const hasAnyYes = Object.values(value).some(v => v);
nextStep = hasAnyYes ? question.yesOutcome : question.noNext;
} else if (question.type === 'category') {
const selectedOption = question.options.find(opt => opt.value === value);
nextStep = selectedOption?.next;
}

if (nextStep) {
setHistory([...history, nextStep]);
setCurrentStep(nextStep);
}
};

const handleBack = () => {
if (history.length > 1) {
const newHistory = [...history];
newHistory.pop();
const previousStep = newHistory[newHistory.length - 1];
setHistory(newHistory);
setCurrentStep(previousStep);
}
};

const handleRestart = () => {
setCurrentStep('start');
setAnswers({});
setHistory(['start']);
setShowDefinition(null);
};

const generateReport = () => {
const outcome = outcomes[currentStep];
const answeredQuestions = Object.keys(answers).filter(key => questions[key]);

let report = `FDA Regulatory Determination Report\n`;
report += `Generated: ${new Date().toLocaleDateString()}\n`;
report += `\n${'='.repeat(60)}\n\n`;
report += `DETERMINATION: ${outcome.title}\n`;
report += `${'-'.repeat(60)}\n`;
report += `${outcome.message}\n\n`;
report += `Details: ${outcome.details}\n\n`;
report += `REQUIREMENTS:\n`;
outcome.requirements.forEach((req, i) => {
report += `${i + 1}. ${req}\n`;
});
report += `\nNEXT STEPS:\n`;
outcome.nextSteps.forEach((step, i) => {
report += `${i + 1}. ${step}\n`;
});
report += `\n${'='.repeat(60)}\n\n`;
report += `DECISION PATH:\n`;
answeredQuestions.forEach((key, i) => {
const q = questions[key];
const a = answers[key];
let answerText = '';
if (typeof a === 'boolean') {
answerText = a ? 'Yes' : 'No';
} else if (typeof a === 'string') {
answerText = a;
} else if (typeof a === 'object') {
answerText = Object.entries(a).filter(([k, v]) => v).map(([k]) => k).join(', ') || 'None selected';
}
report += `${i + 1}. ${q.text}\n Answer: ${answerText}\n\n`;
});
report += `\nFor further consultation, contact Regulatory Affairs at RegAffairs@CDC.Gov\n`;

return report;
};

const downloadReport = () => {
const report = generateReport();
const blob = new Blob([report], { type: 'text/plain' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `FDA_Determination_Report_${new Date().toISOString().split('T')[0]}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
};

const renderQuestion = () => {
const question = questions[currentStep];

if (!question) {
// We're at an outcome
const outcome = outcomes[currentStep];
if (!outcome) return null;

const IconComponent = outcome.icon;

return (
<div className="max-w-4xl mx-auto">
<div className={`rounded-lg shadow-lg p-8 ${
outcome.type === 'success' ? 'bg-green-50 border-2 border-green-500' :
outcome.type === 'error' ? 'bg-red-50 border-2 border-red-500' :
outcome.type === 'warning' ? 'bg-yellow-50 border-2 border-yellow-500' :
'bg-blue-50 border-2 border-blue-500'
}`}>
<div className="flex items-start mb-6">
<IconComponent className={`w-12 h-12 mr-4 ${
outcome.type === 'success' ? 'text-green-600' :
outcome.type === 'error' ? 'text-red-600' :
outcome.type === 'warning' ? 'text-yellow-600' :
'text-blue-600'
}`} />
<div>
<h2 className="text-3xl font-bold mb-2">{outcome.title}</h2>
<p className="text-lg text-gray-700">{outcome.message}</p>
</div>
</div>

<div className="mb-6">
<p className="text-gray-800 font-medium">{outcome.details}</p>
</div>

<div className="mb-6">
<h3 className="text-xl font-bold mb-3 flex items-center">
<FileText className="w-5 h-5 mr-2" />
Requirements
</h3>
<ul className="space-y-2">
{outcome.requirements.map((req, i) => (
<li key={i} className="flex items-start">
<CheckCircle className="w-5 h-5 mr-2 mt-0.5 flex-shrink-0 text-gray-600" />
<span className="text-gray-700">{req}</span>
</li>
))}
</ul>
</div>

<div className="mb-6">
<h3 className="text-xl font-bold mb-3 flex items-center">
<ChevronRight className="w-5 h-5 mr-2" />
Next Steps
</h3>
<ol className="space-y-2">
{outcome.nextSteps.map((step, i) => (
<li key={i} className="flex items-start">
<span className="font-bold mr-2 text-gray-600">{i + 1}.</span>
<span className="text-gray-700">{step}</span>
</li>
))}
</ol>
</div>

<div className="flex gap-4 pt-6 border-t-2 border-gray-300">
<button
onClick={downloadReport}
className="flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition flex items-center justify-center font-semibold"
>
<Download className="w-5 h-5 mr-2" />
Download Report
</button>
<button
onClick={handleRestart}
className="flex-1 bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition flex items-center justify-center font-semibold"
>
Start New Assessment
</button>
</div>
</div>
</div>
);
}

if (question.type === 'category') {
return (
<div className="max-w-2xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-8">
<h2 className="text-2xl font-bold mb-2">{question.text}</h2>
{question.description && (
<p className="text-gray-600 mb-6">{question.description}</p>
)}
<div className="grid grid-cols-1 md:grid-cols-2 gap-4">
{question.options.map((option) => (
<button
key={option.value}
onClick={() => handleAnswer(currentStep, option.value)}
className="p-6 border-2 border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition text-left"
>
<div className="text-4xl mb-2">{option.icon}</div>
<div className="text-xl font-semibold">{option.label}</div>
</button>
))}
</div>
</div>
</div>
);
}

if (question.type === 'boolean') {
return (
<div className="max-w-2xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-8">
<div className="mb-6">
<div className="flex items-start justify-between mb-2">
<h2 className="text-2xl font-bold flex-1">{question.text}</h2>
{question.definitionKey && (
<button
onClick={() => setShowDefinition(showDefinition === question.definitionKey ? null : question.definitionKey)}
className="ml-4 text-blue-600 hover:text-blue-800"
>
<HelpCircle className="w-6 h-6" />
</button>
)}
</div>
{question.description && (
<p className="text-gray-600 mb-4">{question.description}</p>
)}
{question.longDescription && (
<div className="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4">
<p className="text-sm text-gray-700">{question.longDescription}</p>
</div>
)}
{showDefinition === question.definitionKey && (
<div className="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-4">
<p className="text-sm font-semibold text-gray-800">
{definitions[question.definitionKey]}
</p>
</div>
)}
{question.helpText && (
<div className="bg-gray-50 border-l-4 border-gray-400 p-4">
<p className="text-sm text-gray-700">
<Info className="w-4 h-4 inline mr-2" />
{question.helpText}
</p>
</div>
)}
</div>
<div className="grid grid-cols-2 gap-4">
<button
onClick={() => handleAnswer(currentStep, true)}
className="bg-green-600 text-white px-8 py-4 rounded-lg hover:bg-green-700 transition text-xl font-semibold"
>
Yes
</button>
<button
onClick={() => handleAnswer(currentStep, false)}
className="bg-red-600 text-white px-8 py-4 rounded-lg hover:bg-red-700 transition text-xl font-semibold"
>
No
</button>
</div>
</div>
</div>
);
}

if (question.type === 'multi-checkbox') {
const currentAnswers = answers[currentStep] || {};

return (
<div className="max-w-2xl mx-auto">
<div className="bg-white rounded-lg shadow-lg p-8">
<h2 className="text-2xl font-bold mb-2">{question.text}</h2>
{question.description && (
<p className="text-gray-600 mb-4">{question.description}</p>
)}
{question.helpText && (
<div className="bg-gray-50 border-l-4 border-gray-400 p-4 mb-6">
<p className="text-sm text-gray-700">
<Info className="w-4 h-4 inline mr-2" />
{question.helpText}
</p>
</div>
)}
<div className="space-y-3 mb-6">
{question.options.map((option) => (
<label
key={option.value}
className="flex items-center p-4 border-2 border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
>
<input
type="checkbox"
checked={currentAnswers[option.value] || false}
onChange={(e) => {
const newAnswers = {
...currentAnswers,
[option.value]: e.target.checked
};
setAnswers({ ...answers, [currentStep]: newAnswers });
}}
className="w-5 h-5 mr-3"
/>
<span className="text-lg">{option.label}</span>
</label>
))}
</div>
<button
onClick={() => handleAnswer(currentStep, currentAnswers)}
className="w-full bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition text-xl font-semibold"
>
Continue
</button>
</div>
</div>
);
}

return null;
};

const progressPercentage = ((history.length - 1) / 15) * 100;

return (
<div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-8 px-4">
<div className="max-w-6xl mx-auto">
{/* Header */}
<div className="text-center mb-8">
<h1 className="text-4xl font-bold text-gray-800 mb-2">
FDA Regulatory Determination Tool
</h1>
<p className="text-gray-600 text-lg">
Interactive decision tree for Drugs, Biologics, and Medical Devices
</p>
</div>

{/* Progress Bar */}
{currentStep !== 'start' && !outcomes[currentStep] && (
<div className="mb-6 bg-white rounded-lg shadow p-4">
<div className="flex items-center justify-between mb-2">
<span className="text-sm font-semibold text-gray-600">Progress</span>
<span className="text-sm text-gray-600">Step {history.length}</span>
</div>
<div className="w-full bg-gray-200 rounded-full h-2">
<div
className="bg-blue-600 h-2 rounded-full transition-all duration-300"
style={{ width: `${Math.min(progressPercentage, 100)}%` }}
/>
</div>
</div>
)}

{/* Back Button */}
{history.length > 1 && !outcomes[currentStep] && (
<div className="mb-6">
<button
onClick={handleBack}
className="flex items-center text-blue-600 hover:text-blue-800 font-semibold"
>
<ChevronLeft className="w-5 h-5 mr-1" />
Back to Previous Question
</button>
</div>
)}

{/* Main Content */}
{renderQuestion()}

{/* Footer */}
<div className="mt-8 text-center text-sm text-gray-600">
<p className="mb-2">
This tool is based on FDA regulations as of October 2025. Always consult with Regulatory Affairs for official guidance.
</p>
<p>
For questions, contact: <a href="mailto:RegAffairs@CDC.Gov" className="text-blue-600 hover:underline">RegAffairs@CDC.Gov</a>
</p>
<p className="mt-2 text-xs">
Regulations: 21 CFR 50, 56, 312, 812, 809
</p>
</div>
</div>
</div>
);
};

// Render the app and hide loading spinner
try {
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<FDADecisionTreeBot />);
document.getElementById('loading').style.display = 'none';
} catch (error) {
console.error('Failed to render app:', error);
document.getElementById('loading').style.display = 'none';
document.getElementById('error-message').style.display = 'block';
}
</script>
```

</body>
</html>
